document.getElementsByClassName("accordion-more")[0].addEventListener("click",(function(){var e=document.getElementsByClassName("accordion-content")[0];"block"!=e.style.display?(document.getElementsByClassName("accordion-more")[0].innerText="Mostrar menos",e.style.display="block"):(document.getElementsByClassName("accordion-more")[0].innerText="Mostrar mÃ¡s",e.style.display=null)}));var METRO_MADRID_ACCOUNT_ID=182764833,TWITTER_URL="https://twitter.com/";function onDataReceived(){d3.select("#spinner").remove(),d3.select(".info").attr("class","box info")}function getTweetText(e){return void 0===e.extended_tweet?e.text:e.extended_tweet.full_text}function getClassByClass(e){return"issue"===e.classification.naive_bayes.result?"metro-issue":"complaint"===e.classification.naive_bayes.result?"metro-complaint":void 0}function showTweet(e){d3.event.preventDefault();var t=document.createElement("DIV");t.setAttribute("class","user-tweet-example");var a=document.createElement("DIV");a.appendChild(document.createTextNode("X")),a.setAttribute("class","user-tweet-example-close"),a.addEventListener("click",e=>onCloseExampleTweet(a,e));var n=document.createElement("DIV");n.setAttribute("class","user-tweet-example-img");var s=document.createElement("IMG");s.setAttribute("src",e.user.profile_image_url_https),n.appendChild(s);var r=document.createElement("DIV");r.setAttribute("class","user-tweet-example-content");var l=document.createElement("DIV");l.setAttribute("class","user-tweet-example-info");var d=document.createElement("DIV");d.setAttribute("class","user-tweet-example-info-text");var i=document.createTextNode(getTweetText(e));d.appendChild(i);var c=document.createElement("A");c.setAttribute("href",TWITTER_URL+e.user.screen_name+"/status/"+e.id_str),c.setAttribute("target","_blank"),c.setAttribute("rel","noopener noreferrer"),c.appendChild(document.createTextNode("Abrir en Twitter")),d.appendChild(c);var o=document.createElement("DIV");o.setAttribute("class","user-tweet-example-screenname"),o.appendChild(document.createTextNode(e.user.screen_name)),l.appendChild(o);var m=document.createElement("DIV");m.setAttribute("class","user-tweet-example-date"),m.appendChild(document.createTextNode(moment(new Date(e.timestamp_ms)).format("LT"))),l.appendChild(m),r.appendChild(l),r.appendChild(d),t.appendChild(n),t.appendChild(r),t.appendChild(a),document.getElementById(e.id_str).parentNode.appendChild(t),console.log(e)}function onCloseExampleTweet(e,t){t.preventDefault(),e.parentNode.parentNode.removeChild(e.parentNode)}moment.locale("es"),d3.json("/tweets").then(e=>{onDataReceived();var t=d3.select("body").append("div").attr("class","element-container box"),a=d3.nest().key(e=>moment(new Date(e.timestamp_ms)).format("dddd[,] LL")).key(e=>moment(new Date(e.timestamp_ms)).format("HH")).entries(e);t.append("div").attr("class","element-now").text("Ahora");var n=t.selectAll("div.element-date").data(a).enter().append("div").attr("id",e=>e.key).attr("class","element-date");n.append("h2").text(e=>e.key).attr("class","element-date-title");var s=n.append("div").attr("class","element-date-tweets").selectAll("div.element-hour").data(e=>e.values).enter().append("div").attr("class","element-hour"),r=s.append("div").attr("class","user-tweets");s.append("h3").text(e=>e.key+":00").attr("class","element-hour-title");var l=r.selectAll("div.element").data(e=>e.values).enter().filter(e=>e.user.id!=METRO_MADRID_ACCOUNT_ID).append("div").attr("id",e=>e.id_str).attr("class",e=>"element element-"+getClassByClass(e));l.on("click",e=>{showTweet(e,l)});var d=s.append("div").attr("class","official-tweets").selectAll("div.official-tweet").data(e=>e.values).enter().filter(e=>e.user.id===METRO_MADRID_ACCOUNT_ID).append("div").attr("class","official-tweet");d.append("img").attr("class","official-tweet-img").attr("src",e=>e.user.profile_image_url_https);var i=d.append("div").attr("class","official-tweet-container"),c=i.append("div").attr("class","official-tweet-info only-desktop");i.append("div").text(e=>getTweetText(e)),c.append("div").attr("class","official-tweet-info-name").text(e=>e.user.name),c.append("div").attr("class","official-tweet-info-screenname").text(e=>"@"+e.user.screen_name),c.append("div").attr("class","official-tweet-info-time").text(e=>moment(new Date(e.timestamp_ms)).format("LT"))});
